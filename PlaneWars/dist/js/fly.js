$(function(){class a{constructor(a){switch(a){case 0:{b.health=4;break}case 1:{b.health=3;break}case 2:{b.health=2;break}case 3:b.health=1,console.log(a);}this.load()}load(){console.log(1),$("#menu").hide(),$("#loading").show();let a=2,b=1;this.loadTimer=setInterval(function(){b++,$("#loading").css("background","url(img/loading"+a+".png)"),a=3==a?1:++a,7<=b&&(clearInterval(this.loadTimer),$("#loading").hide(),$("#logo").hide(),$("#score").show(),this.backMove(),this.start())}.bind(this),1e3)}backMove(){let a=0;this.backMoveTimer=setInterval(function(){$("#back").css("background-position-y",a+=2)},30)}start(){this.play=new c,this.play.playerMove(),this.prEnemy1=setInterval(function(){let a=new b("A");b.arr.add(a)},1e4),this.prEnemy2=setInterval(function(){let a=new b("B");b.arr.add(a)},4e3),this.prEnemy3=setInterval(function(){let a=new b("C");b.arr.add(a)},1500)}over(){clearInterval(this.prEnemy1),clearInterval(this.prEnemy2),clearInterval(this.prEnemy3),clearInterval(this.backMoveTimer),clearInterval(this.crashTimer)}}a.score=0;class b{constructor(a){switch(this.$en=$("<div>"),this.$en.appendTo($("#back")),this.$en.addClass("enemy"),this.type=a,a){case"A":{this.score=5e3,this.speed=1,this.hp=3*b.health,this.$en.width(165),this.$en.height(256),this.$en.css({background:"url(img/plain3.png)",left:getRandom(0,$("#back").width()-164),top:-256}),this.die=function(){let a=1;this.deiTimer=setInterval(function(){this.$en.css({background:"url(img/plain3_die"+a++ +".png)"}),8<=a&&(clearInterval(this.deiTimer),this.over())}.bind(this),100)};break}case"B":{this.score=1e3,this.speed=3,this.hp=2*b.health,this.$en.width(70),this.$en.height(92),this.$en.css({background:"url(img/plain2.png)",left:getRandom(0,$("#back").width()-69),top:-92}),this.die=function(){let a=1;this.deiTimer=setInterval(function(){this.$en.css({background:"url(img/plain2_die"+a++ +".png)"}),6<=a&&(clearInterval(this.deiTimer),this.over())}.bind(this),100)};break}case"C":this.score=100,this.speed=5,this.hp=1,this.$en.width(59),this.$en.height(36),this.$en.css({background:"url(img/plane1.png)",left:getRandom(0,$("#back").width()-58),top:-36}),this.die=function(){let a=1;this.deiTimer=setInterval(function(){this.$en.css({background:"url(img/plain1_die"+a++ +".png)"}),5<=a&&(clearInterval(this.deiTimer),this.over())}.bind(this),100)};}this.enFlyTimer=setInterval(function(){this.$en.css({top:this.$en.position().top+this.speed}),this.$en.position().top>=$("#back").height()&&this.over()}.bind(this),30)}over(){clearInterval(this.enFlyTimer),this.$en.remove()}}b.arr=new Set;class c{constructor(){c.HP=1,this.ammo=1,this.$player=$("<div>"),this.$player.addClass("player"),this.$player.css("background","url(img/me.png)"),this.$player.css({top:$("#back").height()-122,left:$("#back").width()/2-40}),this.$player.appendTo($("#back"))}playerMove(){$(document).mousemove(function(a){var c=Math.max,d=Math.min;this.$player.css({top:c(d(a.pageY-this.$player.outerHeight()/2,$("#back").outerHeight()-this.$player.outerHeight()),0),left:c(0,d(a.pageX-$("#back").offset().left-this.$player.outerWidth()/2,$("#back").outerWidth()-this.$player.outerWidth()))});for(var e of b.arr)(this.$player.position().top<=e.$en.position().top+e.$en.height()&&this.$player.position().top>=e.$en.position().top||this.$player.position().top<=e.$en.position().top&&this.$player.position().top+this.$player.height()>=e.$en.position().top+e.$en.height()||this.$player.position().top+this.$player.height()>=e.$en.position().top&&this.$player.position().top+this.$player.height()<=e.$en.position().top+e.$en.height())&&(this.$player.position().left<=e.$en.position().left+e.$en.width()&&this.$player.position().left>=e.$en.left||this.$player.position().left+this.$player.width()>=e.$en.position().left&&this.$player.position().left+this.$player.width()<=e.$en.position().left+e.$en.width()||this.$player.position().left<=e.$en.position().left&&this.$player.position().left+this.$player.width()>=e.$en.position().left+e.$en.width())&&(this.die(),e.die(),setTimeout(function(){alert("\u60A8\u7684\u5F97\u5206\u4E3A\uFF1A"+$("#score").find("span").text()),location.reload()},300))}.bind(this)),this.fire()}fire(){this.fireTimer=setInterval(function(){let d=$("<div>");d.addClass("ammo"),d.css({top:this.$player.position().top-20,left:this.$player.position().left+this.$player.outerWidth()/2-2}),d.appendTo($("#back"));let e=setInterval(function(){d.css({top:d.position().top-5}),(0>=d.position().top||0>=d.position().left||d.position().left>=$("#back").outerWidth())&&(d.remove(),clearInterval(e),c.bullet.has(d)&&c.bullet.delete(d));for(var f of b.arr)d.position().top<=f.$en.position().top+f.$en.height()&&d.position().top>=f.$en.position().top&&(d.position().left<=f.$en.position().left+f.$en.width()&&d.position().left>=f.$en.left||d.position().left>=f.$en.position().left&&d.position().left<=f.$en.position().left+f.$en.width())&&(f.hp--,0==f.hp?(d.css({background:"url(img/die2.png)",width:40,height:43,opacity:.5}).animate({opacity:1},200,function(){d.remove()}),b.arr.has(f)&&(a.score+=f.score,$("#score").find("span").text(a.score),f.die(),b.arr.delete(f))):d.css({background:"url(img/die1.png)",width:41,height:39,opacity:.5}).animate({opacity:1},200,function(){d.remove()}),clearInterval(e),c.bullet.has(d)&&c.bullet.delete(d))},30);c.bullet.add(d)}.bind(this),200)}die(){$(document).unbind("mousemove");let a=1;this.deiTimer=setInterval(function(){this.$player.css({background:"url(img/me_die"+a++ +".png)"}),5<=a&&(console.log(a),clearInterval(this.deiTimer),this.$player.remove(),this.over())}.bind(this),100)}over(){clearInterval(this.fireTimer)}}c.bullet=new Set,$("ul").on("click","li",function(){new a($(this).index())})});